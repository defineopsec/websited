<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Rainbet Exchange</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root {
    /* Rainbet Farbpalette */
    --bg-dark: #0A0E1E;
    --bg-main: #191F3B;
    --bg-card: #1B213C;
    --bg-sidebar: #1B213C;
    --bg-button: #212747;
    --bg-button-hover: #2A2F52;
    --bg-input: #262C50;
    
    /* Akzentfarben */
    --accent-blue: #0077DB;
    --accent-blue-light: #1F99FF;
    --accent-blue-dark: #006CC7;
    --accent-gradient: linear-gradient(90deg, #0077DB, #1F99FF);
    --accent-green: #13BD9B;
    --accent-purple: #5E679E;
    
    /* Textfarben */
    --text-primary: #E8E5FF;
    --text-secondary: #7D7E97;
    --text-muted: #8B93B5;
    --text-light: #FFFFFF;
    
    /* Border/Overlay */
    --border-color: rgba(232, 229, 255, 0.05);
    --border-light: rgba(232, 229, 255, 0.1);
    --overlay: rgba(255, 255, 255, 0.03);
    
    /* Effekte */
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.25);
    --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.3);
    --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.35);
    --glow-blue: 0 0 20px rgba(31, 153, 255, 0.15);
    
    /* Border Radius */
    --radius-sm: 6px;
    --radius-md: 8px;
    --radius-lg: 10px;
    --radius-xl: 12px;
    --radius-full: 9999px;
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    background: var(--bg-dark);
    color: var(--text-primary);
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    font-size: 14px;
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
    overflow-x: hidden;
  }

  /* Layout */
  .layout {
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 20px;
    min-height: 100vh;
    padding: 0;
    background: var(--bg-dark);
  }

  @media (max-width: 1100px) {
    .layout {
      grid-template-columns: 1fr;
      padding: 0;
    }
    .sidebar {
      display: none;
    }
  }

  /* SIDEBAR - Rainbet Style */
  .sidebar {
    background: var(--bg-sidebar);
    border-right: 1px solid var(--border-color);
    height: 100vh;
    position: sticky;
    top: 0;
    overflow-y: auto;
    padding: 20px 0;
  }

  .brand {
    padding: 0 20px 20px;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 20px;
  }

  .logo-link {
    display: block;
    width: 200px;
    height: 40px;
    overflow: hidden;
  }

  .logo-link img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    filter: brightness(1.1);
  }

  .nav {
    padding: 0 15px;
  }

  .nav a {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    color: var(--text-secondary);
    text-decoration: none;
    font-weight: 500;
    font-size: 13px;
    border-radius: var(--radius-md);
    margin-bottom: 4px;
    transition: all 0.2s ease;
    border: 1px solid transparent;
  }

  .nav a:hover {
    background: rgba(255, 255, 255, 0.03);
    color: var(--text-primary);
    border-color: var(--border-light);
  }

  .nav a i {
    width: 18px;
    text-align: center;
    font-size: 16px;
  }

  .small {
    font-size: 11px;
    color: var(--text-secondary);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    padding: 20px 20px 8px;
    margin-top: 10px;
  }

  /* Recent Swaps */
  .swap-list-item {
    padding: 10px 16px;
    border-bottom: 1px solid var(--border-color);
    font-size: 13px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  .swap-list-item.show {
    opacity: 1;
    transform: translateY(0);
  }

  .swap-list-item .amount {
    color: var(--accent-blue-light);
    font-weight: 600;
    font-family: 'Inter', monospace;
  }

  /* Swaps Animation Container */
  .swaps-animation-container {
    height: 180px;
    overflow: hidden;
    position: relative;
  }

  .swaps-inner-container {
    position: absolute;
    width: 100%;
    transition: transform 0.8s ease;
  }

  /* MAIN CONTENT */
  .main {
    padding: 20px;
    background: var(--bg-dark);
  }

  /* Topbar */
  .topbar {
    background: var(--bg-main);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-xl);
    padding: 12px 20px;
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: var(--shadow-sm);
  }

  .top-left {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .top-actions {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* Buttons */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 10px 18px;
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid transparent;
    text-decoration: none;
    white-space: nowrap;
  }

  .btn-primary {
    background: var(--accent-gradient);
    color: white;
    border-color: var(--accent-blue-light);
  }

  .btn-primary:hover {
    background: linear-gradient(90deg, var(--accent-blue-dark), #52B0FF);
    border-color: #52B0FF;
    transform: translateY(-1px);
    box-shadow: var(--glow-blue);
  }

  .btn-ghost {
    background: var(--bg-button);
    color: var(--text-primary);
    border-color: var(--border-color);
  }

  .btn-ghost:hover {
    background: var(--bg-button-hover);
    border-color: rgba(232, 229, 255, 0.1);
  }

  .btn-icon {
    width: 42px;
    height: 42px;
    padding: 0;
    justify-content: center;
  }

  /* Hero Section */
  .hero {
    background: var(--bg-main);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-xl);
    padding: 24px;
    margin-bottom: 20px;
    box-shadow: var(--shadow-md);
  }

  .hero h1 {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 8px;
    background: linear-gradient(90deg, #E8E5FF, #A6D6FF);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .hero p {
    color: var(--text-muted);
    font-size: 14px;
  }

  /* Swap Container */
  .swap-wrap {
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 20px;
  }

  @media (max-width: 1100px) {
    .swap-wrap {
      grid-template-columns: 1fr;
    }
  }

  /* Card */
  .card {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-xl);
    padding: 24px;
    box-shadow: var(--shadow-md);
  }

  .card h2 {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 16px;
    color: var(--text-primary);
  }

  /* Form Elements */
  .form-group {
    margin-bottom: 16px;
  }

  label {
    display: block;
    color: var(--text-secondary);
    font-size: 12px;
    font-weight: 600;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  select, input[type="number"], input[type="text"], input[type="email"] {
    width: 100%;
    padding: 12px 16px;
    background: var(--bg-input);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-size: 14px;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  select:focus, input:focus {
    outline: none;
    border-color: var(--accent-blue-light);
    box-shadow: 0 0 0 2px rgba(31, 153, 255, 0.1);
  }

  /* Grid */
  .grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  /* Swap Center Button */
  .swap-center {
    display: flex;
    justify-content: center;
    margin: 16px 0;
  }

  .swap-btn {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: var(--accent-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    border: 4px solid var(--bg-card);
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: var(--shadow-lg);
  }

  .swap-btn:hover {
    transform: scale(1.08) rotate(180deg);
    box-shadow: var(--glow-blue);
  }

  /* Rate Display */
  .rate {
    background: rgba(31, 153, 255, 0.05);
    border: 1px solid rgba(31, 153, 255, 0.1);
    border-radius: var(--radius-lg);
    padding: 20px;
    text-align: center;
    margin-top: 20px;
  }

  .rate .big {
    font-size: 28px;
    font-weight: 700;
    color: var(--accent-blue-light);
    margin: 8px 0;
    font-family: 'Inter', monospace;
  }

  /* Mini Cards */
  .mini {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: 16px;
    margin-bottom: 12px;
  }

  .mini h4 {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text-primary);
  }

  /* Modal */
  .modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(10, 14, 30, 0.9);
    z-index: 10000;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .modal-content {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-xl);
    padding: 24px;
    max-width: 460px;
    width: 100%;
    box-shadow: var(--shadow-lg);
    animation: modalIn 0.3s ease-out;
  }

  @keyframes modalIn {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Footer */
  .disclaimer {
    background: var(--bg-main);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: 16px;
    color: var(--text-secondary);
    font-size: 12px;
    text-align: center;
    margin-top: 20px;
  }

  /* Footer Styles */
  .footer {
    background: var(--bg-main);
    border-top: 1px solid var(--border-color);
    margin-top: 40px;
    padding: 40px 20px 20px;
  }

  .footer-container {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 40px;
  }

  .footer-section h3 {
    color: var(--text-primary);
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 20px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .footer-links {
    list-style: none;
  }

  .footer-links li {
    margin-bottom: 12px;
  }

  .footer-links a {
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 14px;
    transition: color 0.2s ease;
  }

  .footer-links a:hover {
    color: var(--accent-blue-light);
  }

  .company-info {
    color: var(--text-secondary);
    line-height: 1.6;
    font-size: 14px;
    margin-bottom: 20px;
  }

  .copyright {
    text-align: center;
    color: var(--text-muted);
    font-size: 12px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
    margin-top: 40px;
  }

  /* Utility Classes */
  .muted {
    color: var(--text-secondary);
    font-size: 13px;
  }

  .text-accent {
    color: var(--accent-blue-light);
  }

  .bg-gradient {
    background: var(--accent-gradient);
  }

  /* Loading Animation */
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .loading {
    animation: pulse 1.5s ease-in-out infinite;
  }
</style>
</head>
<body>

<div class="layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="brand">
      <a class="logo-link" href="https://rainbet.com" target="_blank" rel="noopener noreferrer" title="Go to rainbet.com">
        <img src="https://media.discordapp.net/attachments/1447858042371833956/1448009324000444517/logo-removebg-preview.png?ex=6939b345&is=693861c5&hm=ad533ad3b67c39dd06f8f2a59ed2ce616b87cf3d7818085d59607c20eb1ddfac&=&format=webp&quality=lossless" alt="Rainbet Exchange Logo" />
      </a>
    </div>

    <nav class="nav" aria-label="Hauptnavigation">
      <a href="https://rainbet.com">
        <i class="fa-solid fa-house"></i>
        <span>Home</span>
      </a>
      <a href="https://rainbet.com/casino">
        <i class="fa-solid fa-champagne-glasses"></i>
        <span>Casino</span>
      </a>
      <a href="https://rainbet.com/sportsbook">
        <i class="fa-solid fa-basketball-ball"></i>
        <span>Sports</span>
      </a>
      <a href="https://rainbet.com/rewards">
        <i class="fa-solid fa-gift"></i>
        <span>Promotions</span>
      </a>
      <a href="https://rainbet.com/?modal=profile&tab=overview">
        <i class="fa-solid fa-user"></i>
        <span>Account</span>
      </a>
    </nav>
    
    <div class="small">Recent Swaps</div>
    <div class="swaps-animation-container">
      <div id="recent_swaps_list" class="swaps-inner-container">
        <!-- Swaps werden hier dynamisch eingefügt -->
      </div>
    </div>
    
    <div class="small">Races & VIP</div>
    <div style="padding: 8px 15px 0;">
      <div class="mini">
        <div style="font-weight: 700; color: var(--accent-green);">$25K</div>
        <div class="muted">Daily Race • Live</div>
      </div>
      <div class="mini" style="margin-top: 8px;">
        <div style="font-weight: 700; color: var(--accent-green);">$100K</div>
        <div class="muted">Weekly Race • Live</div>
      </div>
    </div>

    <div style="padding: 20px 15px 0;">
      <div class="disclaimer">
        <strong style="color: var(--text-primary);">Rainbet Exchange</strong><br/>
        Instant Crypto Trading
      </div>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main">

    <!-- Topbar -->
    <div class="topbar">
      <div class="top-left">
        <span class="muted">Welcome, Guest!</span>
      </div>
      
      <div class="top-actions">
        <a href="https://rainbet.com/contact-us" class="btn btn-ghost btn-icon" title="Support">
          <i class="fa-regular fa-message"></i>
        </a>
        <a href="https://rainbet.com/settings" class="btn btn-ghost btn-icon" title="Settings">
          <i class="fa-solid fa-gear"></i>
        </a>
        <a href="https://rainbet.com/?modal=auth&tab=register" class="btn btn-primary">
          <i class="fa-solid fa-user"></i>
          <span>Register</span>
        </a>
      </div>
    </div>

    <!-- Hero Section -->
    <section class="hero">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <h1>Experience Swapping, without Boundaries!</h1>
          <p class="muted">Instant crypto-to-crypto exchange with competitive rates</p>
        </div>
        <div style="display: flex; align-items: center; gap: 12px;">
          <div style="padding: 8px 16px; background: rgba(31, 153, 255, 0.1); border-radius: var(--radius-md); font-weight: 700; color: var(--accent-blue-light);">
            RAINBET
          </div>
          <span class="muted">Official Exchange Platform</span>
        </div>
      </div>
    </section>

    <!-- Swap Section -->
    <section class="swap-wrap">
      <!-- Main Swap Card -->
      <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2>Instant Crypto Swap</h2>
          <div class="muted">Fee: <strong class="text-accent">0.25%</strong></div>
        </div>

        <div class="grid-2">
          <div class="form-group">
            <label for="send_crypto">You send</label>
            <select id="send_crypto"></select>
          </div>
          <div class="form-group">
            <label for="receive_crypto">You receive</label>
            <select id="receive_crypto"></select>
          </div>

          <div class="form-group" style="grid-column: 1 / -1;">
            <label for="send_amount">Amount to send</label>
            <input id="send_amount" type="number" min="0.0001" step="any" value="0.001" />
          </div>

          <div style="grid-column: 1 / -1;" class="swap-center">
            <div class="swap-btn" id="swap_btn" title="Swap currencies" onclick="swapCurrencies()">
              <i class="fa-solid fa-arrow-right-arrow-left"></i>
            </div>
          </div>

          <div class="form-group" style="grid-column: 1 / -1;">
            <label for="receive_address">Recipient address</label>
            <input id="receive_address" type="text" placeholder="Paste your wallet address" />
          </div>
        </div>

        <div class="rate">
          <div class="muted">Estimated receive</div>
          <div class="big" id="estimated_receive">—</div>
          <div class="muted" id="rate_detail">Live Rate</div>
        </div>

        <div style="display: flex; gap: 12px; margin-top: 20px;">
          <button class="btn btn-primary" id="start_swap" onclick="createOrder()" style="flex: 1;">
            Start Swap
          </button>
          <button class="btn btn-ghost" onclick="openPaypalModeSelection()">
            <i class="fa-brands fa-paypal"></i>
            <span>PayPal</span>
          </button>
        </div>
      </div>

      <!-- Right Sidebar -->
      <aside class="right">
        <div class="mini">
          <h4>Recent Wins</h4>
          <div class="muted">Players are winning now!</div>
          <div style="margin-top: 12px; color: var(--accent-green); font-weight: 600;">
            <i class="fa-solid fa-trophy"></i> $4,250 BTC won
          </div>
        </div>

        <div class="mini">
          <h4>Quick Stats</h4>
          <div style="display: flex; gap: 20px; margin-top: 12px;">
            <div>
              <div style="font-weight: 700; color: var(--accent-blue-light);">1.2K</div>
              <div class="muted">Active</div>
            </div>
            <div>
              <div style="font-weight: 700; color: var(--accent-blue-light);">$48K</div>
              <div class="muted">24h vol</div>
            </div>
          </div>
        </div>

        <div class="mini">
          <h4>Support</h4>
          <div class="muted">24/7 Live chat & email</div>
          <button class="btn btn-ghost" style="width: 100%; margin-top: 12px;">
            <i class="fa-regular fa-comment-dots"></i>
            Start Chat
          </button>
        </div>

        <div class="disclaimer">
          <strong style="color: var(--text-primary);">Rainbet Exchange</strong><br/>
          Copyright © 2025 Rainbet.com. All Rights Reserved.<br/>
          <span style="font-size: 11px; opacity: 0.7;">Secure & Instant Trading</span>
        </div>
      </aside>
    </section>
  </main>
</div>

<!-- Footer Section -->
<footer class="footer">
  <div class="footer-container">
    
    <!-- Company Info -->
    <div class="footer-section">
      <h3>Rainbet Exchange</h3>
      <div class="company-info">
        Rainbet Exchange is a brand name of RBGAMING N.V.<br><br>
        Company Address: Hamchako, Mustamudu,<br>
        Autonomous Island of Anjouan Union of Comoros<br><br>
        support@rainbet.com<br>
        marketing@rainbet.com<br><br>
        RAINBET EXCHANGE
      </div>
    </div>

    <!-- Navigation -->
    <div class="footer-section">
      <h3>Navigation</h3>
      <ul class="footer-links">
        <li><a href="https://rainbet.exchange">Exchange</a></li>
        <li><a href="https://rainbet.com/">Markets</a></li>
        <li><a href="https://rainbet.com/?modal=wallet&tab=deposit">Wallet</a></li>
        <li><a href="https://rainbet.com/rewards">Rewards</a></li>
        <li><a href="https://rainbet.com/rewards">Promotions</a></li>
        <li><a href="https://rainbet.com/contact-us">Contact Us</a></li>
      </ul>
    </div>

    <!-- Resources -->
    <div class="footer-section">
      <h3>Resources</h3>
      <ul class="footer-links">
        <li><a href="https://rainbet.com/responsible-gambling">Responsible Gambling</a></li>
        <li><a href="https://rainbet.com/accessibility">Accessibility</a></li>
        <li><a href="https://rainbet.com/code-of-ethics">Code of Ethics</a></li>
        <li><a href="https://rainbet.com/modern-slavery-statement">Modern Slavery Statement</a></li>
        <li><a href="https://rainbet.com/complaints-policy">Complaints Policy</a></li>
        <li><a href="https://rainbet.com/privacy-policy">GDPR Compliance</a></li>
      </ul>
    </div>

    <!-- Legal -->
    <div class="footer-section">
      <h3>Legal</h3>
      <ul class="footer-links">
        <li><a href="https://rainbet.com/aml">AML</a></li>
        <li><a href="https://rainbet.com/sportsbook-rules">Trading Rules</a></li>
        <li><a href="https://rainbet.com/cookie-policy">Cookie Policy</a></li>
        <li><a href="https://rainbet.com/editorial-policy">Editorial Policy</a></li>
        <li><a href="https://rainbet.com/disclaimer">Disclaimer</a></li>
        <li><a href="https://rainbet.com/privacy-policy">Privacy Policy</a></li>
        <li><a href="https://rainbet.com/terms">Terms of Service</a></li>
      </ul>
    </div>
  </div>

  <div class="copyright">
    Copyright © 2025 Rainbet Exchange. All Rights Reserved.<br>
    Rainbet Exchange - Instant Crypto Trading Platform
  </div>
</footer>

<!-- PayPal Modal -->
<div id="modal_paypal_select" class="modal">
  <div class="modal-content">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <div style="font-weight: 700; color: var(--accent-blue-light); font-size: 18px;">PayPal Swap Mode</div>
      <button onclick="closeModal('modal_paypal_select')" class="btn btn-ghost btn-icon">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div id="paypal_select_body" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
      <button class="btn btn-primary" style="padding: 20px; flex-direction: column;" onclick="openPaypalModal('crypto_to_paypal')">
        <i class="fa-solid fa-arrow-right-from-bracket" style="transform: rotate(45deg); margin-bottom: 8px; font-size: 20px;"></i>
        Crypto to PayPal
      </button>
      <button class="btn btn-primary" style="padding: 20px; flex-direction: column;" onclick="openPaypalModal('paypal_to_crypto')">
        <i class="fa-solid fa-arrow-right-from-bracket" style="transform: rotate(-135deg); margin-bottom: 8px; font-size: 20px;"></i>
        PayPal to Crypto
      </button>
    </div>
  </div>
</div>

<!-- Main Modal -->
<div id="modal_main" class="modal">
  <div class="modal-content">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <div style="font-weight: 700; color: var(--accent-blue-light);" id="modal_title">Order Details</div>
      <button onclick="closeModal('modal_main')" class="btn btn-ghost btn-icon">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div id="modal_body" style="color: var(--text-secondary); line-height: 1.6;"></div>
    <div style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 24px;">
      <button onclick="closeModal('modal_main')" class="btn btn-ghost">Close</button>
    </div>
  </div>
</div>

<script>
// JavaScript für die erweiterte Funktionalität
const PAYPAL_RECEIVE_EMAIL = 'paypal@rainbet.exchange';
const depositAddresses = {
  'bitcoin': 'bc1qe6n8nj4ptt7rgfwwkwr466cs4q0pdd2u235kmm',
  'ethereum': '0x370EEc968C360E0B592d6eD0C4266435C0FCbBFC',
  'tether': '0x370EEc968C360E0B592d6eD0C42666435C0FCbBFC',
  'ripple': 'rPoKrW9rTrnwcJNAHtVDKST6nUPKY5XFM9',
  'binancecoin': '0x370EEc968C360E0B592d6eD0C42666435C0FCbBFC',
  'solana': 'CcbJbmGqLTKp7nPLTfMPJz39mv3jCXEs44MfJcqmJyiK',
  'cardano': 'addr1q8n97s8k537nhs3vjglltfhgmw0qhr8la2r0hcvg49zlj6lxtaq0dfra80pzey3l7knw3ku7pwx0l65xl0sc3229l94s8vhh4f',
  'litecoin': 'LNvqNfTTAwEPoXv9RnZVpxPwBeMiq5wXQD',
  'dogecoin': 'DJCkaei65UzRfZ9aK58Eq8CoJiYQDY9EZK'
  
};

const cryptoOptions = [
  { id: 'bitcoin', name: 'Bitcoin', symbol: 'BTC' },
  { id: 'ethereum', name: 'Ethereum', symbol: 'ETH' },
  { id: 'tether', name: 'Tether USD', symbol: 'USDT' },
  { id: 'binancecoin', name: 'BNB', symbol: 'BNB' },
  { id: 'ripple', name: 'XRP', symbol: 'XRP' },
  { id: 'solana', name: 'Solana', symbol: 'SOL' },
  { id: 'cardano', name: 'Cardano', symbol: 'ADA' },
  { id: 'litecoin', name: 'Litecoin', symbol: 'LTC' },
  { id: 'dogecoin', name: 'Dogecoin', symbol: 'DOGE' },
].sort((a,b) => a.symbol.localeCompare(b.symbol));

let currentPrices = {};



async function fetchLivePrices() {
  // Erstellt eine kommagetrennte Liste aller CoinGecko IDs (bitcoin,ethereum,tether,...)
  const coinIds = cryptoOptions.map(c => c.id).join(','); 
  const currency = 'usd'; // Abrufen in USD

  // Die öffentliche CoinGecko API URL (kein Schlüssel erforderlich)
  const url = `https://api.coingecko.com/api/v3/simple/price?ids=${coinIds}&vs_currencies=${currency}&include_market_cap=false&include_24hr_vol=false&include_24hr_change=false&include_last_updated_at=false`;
  
  try {
    const response = await fetch(url);

    if (!response.ok) {
      // Wirf einen Fehler, wenn die API antwortet, aber den Status 4xx oder 5xx hat (z.B. bei Rate Limit)
      throw new Error(`API Fehler beim Abrufen der Preise: ${response.status}`);
    }
    
    const data = await response.json();

    let updateCount = 0;
    // Durchläuft alle IDs und aktualisiert die Preise im globalen currentPrices Objekt
    for(const id of cryptoOptions.map(c => c.id)) {
      if (data[id] && data[id][currency]) {
        currentPrices[id] = data[id][currency];
        updateCount++;
      }
    }
    
    // USDT (Tether) ist ein Stablecoin und sollte immer 1.00 sein (Fall-back)
    currentPrices['tether'] = 1.00; 
    
    // Aktualisiert die Anzeige des Wechselkurses
    updateEstimate(); 

    // Optional: Füge eine Konsolenmeldung zur Überwachung hinzu
    console.log(`Live prices successfully updated for ${updateCount} coins.`);
    
  } catch (error) {
    console.error('Konnte Live-Preise nicht abrufen:', error);
    // Die Anwendung läuft mit den alten Preisen oder 0 weiter
  }
}

function calculateRate(fromId, toId, amount) {
  if (fromId === toId) return { received: amount, rate: 1.0, valueUSD: amount * (currentPrices[fromId] || 0) };
  
  const FEE_RATE = 0.0025;
  const priceFrom = currentPrices[fromId] || 0;
  const priceTo = currentPrices[toId] || 0;

  if(priceFrom === 0 || priceTo === 0){
    return { received: 0, rate: 0, valueUSD: 0 };
  }

  const valueUSD = amount * priceFrom;
  const valueAfterFee = valueUSD * (1 - FEE_RATE);
  const receivedAmount = valueAfterFee / priceTo;
  const exchangeRate = (1 * priceFrom * (1 - FEE_RATE)) / priceTo;

  return {
    received: receivedAmount,
    rate: exchangeRate,
    valueUSD: valueUSD
  };
}

function calculateCryptoAmount(fromId, targetUSD) {
  const FEE_RATE = 0.0025;
  const priceFrom = currentPrices[fromId] || 0;

  if (priceFrom === 0) return 0;
  const requiredUSDValue = targetUSD / (1 - FEE_RATE);
  const amount = requiredUSDValue / priceFrom;
  
  return amount;
}

// UI Functions
function $(id) { return document.getElementById(id); }
function getSymById(id) { 
  const c = cryptoOptions.find(x => x.id === id); 
  return c ? c.symbol : id; 
}

function generateCryptoOptions() {
  return cryptoOptions.map(c => `<option value="${c.id}">${c.symbol} — ${c.name}</option>`).join('');
}

function populateSelects() {
  const s = $('send_crypto'), r = $('receive_crypto');
  const optionsHtml = generateCryptoOptions();
  s.innerHTML = optionsHtml;
  r.innerHTML = optionsHtml;
  s.selectedIndex = 0; 
  r.selectedIndex = 2;
}

function updateEstimate() {
  const amt = parseFloat($('send_amount').value) || 0;
  const from = $('send_crypto').value;
  const to = $('receive_crypto').value;
  
  if(amt <= 0){ 
    $('estimated_receive').textContent='—'; 
    $('rate_detail').textContent='Enter amount'; 
    return; 
  }
  
  const { received, rate } = calculateRate(from, to, amt);
  const receivedStr = received.toFixed(received < 1 ? 8 : 4);
  const rateStr = rate.toFixed(rate < 1 ? 8 : 4);

  $('estimated_receive').textContent = `${receivedStr} ${getSymById(to)}`;
  $('rate_detail').textContent = `Live Rate • 1 ${getSymById(from)} ≈ ${rateStr} ${getSymById(to)}`;
}

function swapCurrencies() {
  const s = $('send_crypto'), r = $('receive_crypto');
  const tmp = s.selectedIndex; 
  s.selectedIndex = r.selectedIndex; 
  r.selectedIndex = tmp;
  updateEstimate();
  
  const btn = $('swap_btn');
  btn.style.transform = 'rotate(180deg)';
  setTimeout(() => btn.style.transform = '', 300);
}

function createOrder() {
  const from = $('send_crypto').value;
  const to = $('receive_crypto').value;
  const amt = parseFloat($('send_amount').value) || 0;
  const addr = $('receive_address').value.trim();
  
  if(!addr){ alert('Please enter recipient address'); return; }
  if(amt <= 0){ alert('Please enter an amount greater than zero'); return; }
  
  const { received } = calculateRate(from, to, amt);
  const deposit = depositAddresses[from] || 'demo_deposit_address_not_found';
  
  const depositHtml = `
    <div style="font-weight: 700; color: var(--accent-blue-light); margin-bottom: 16px;">Order successfully created</div>
    <div style="margin-bottom: 16px; color: var(--text-secondary);">
      Send exactly <strong style="color: var(--text-primary);">${amt.toFixed(6)} ${getSymById(from)}</strong> to this deposit address:
    </div>
    <div style="padding: 12px; background: rgba(255,255,255,0.02); border-radius: 8px; font-family: monospace; word-break: break-all; margin-bottom: 16px;">
      ${deposit}
    </div>
    <div style="color: var(--text-secondary);">
      Estimated receive: <strong style="color: var(--accent-blue-light);">${received.toFixed(6)} ${getSymById(to)}</strong>
    </div>
  `;
  
  showModal('modal_main', 'Crypto Swap Order', depositHtml);
}

// Modal Functions
function showModal(modalId, title, html) { 
  const modal = $(modalId); 
  if(modalId === 'modal_main') {
    $('modal_title').textContent = title;
    $('modal_body').innerHTML = html; 
  }
  modal.style.display = 'flex'; 
}

function closeModal(modalId) { 
  $(modalId).style.display = 'none'; 
}

function openPaypalModeSelection() {
  showModal('modal_paypal_select');
}

function openPaypalModal(type) {
  closeModal('modal_paypal_select');
  let modalHtml = '';
  let title = '';
  const optionsHtml = generateCryptoOptions();

  if(type === 'crypto_to_paypal') {
    title = 'Crypto to PayPal Swap';
    modalHtml = `
      <div style="font-weight: 700; color: var(--accent-blue-light); margin-bottom: 12px;">1. Select Crypto & USD Amount</div>
      <div style="color: var(--text-secondary); margin-bottom: 20px;">Choose the cryptocurrency and USD amount you want to receive.</div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
        <div>
          <label for="paypal_send_crypto">Crypto to send</label>
          <select id="paypal_send_crypto">${optionsHtml}</select>
        </div>
        <div>
          <label for="paypal_usd_amount">USD amount to receive</label>
          <input id="paypal_usd_amount" type="number" min="10" step="any" value="100" placeholder="Min 10 USD" />
        </div>
      </div>

      <div style="margin-bottom: 20px;">
        <label for="paypal_recipient_email">Your PayPal Email</label>
        <input id="paypal_recipient_email" type="email" placeholder="your@paypal.email" />
      </div>
      
      <button class="btn btn-primary" style="width: 100%; padding: 14px;" onclick="processCryptoToPaypal()">
        Submit Request (Demo)
      </button>
    `;
  } else if (type === 'paypal_to_crypto') {
    title = 'PayPal to Crypto Swap';
    const randomWords = ['SUN', 'MOON', 'STAR', 'CLOUD', 'RAIN'];
    const randomWord = randomWords[Math.floor(Math.random() * randomWords.length)];
    
    modalHtml = `
      <div style="font-weight: 700; color: var(--accent-blue-light); margin-bottom: 12px;">1. Send PayPal Payment</div>
      <div style="color: var(--text-secondary); margin-bottom: 16px;">
        Send the desired amount via PayPal to this email:
      </div>
      <div style="padding: 12px; background: rgba(31, 153, 255, 0.1); border-radius: 8px; margin-bottom: 20px;">
        ${PAYPAL_RECEIVE_EMAIL}
      </div>
      
      <div style="padding: 12px; border: 1px dashed rgba(31, 153, 255, 0.3); border-radius: 8px; margin-bottom: 20px;">
        <div style="color: var(--text-secondary); margin-bottom: 8px;">IMPORTANT: Include this code in PayPal notes:</div>
        <div style="font-weight: 700; color: var(--accent-blue-light); font-size: 20px; text-align: center;">
          ${randomWord}
        </div>
      </div>

      <div style="font-weight: 700; color: var(--accent-blue-light); margin-bottom: 12px;">2. Select Crypto & Address</div>
      
      <div style="margin-bottom: 16px;">
        <label for="paypal_receive_crypto">Crypto to receive</label>
        <select id="paypal_receive_crypto">${optionsHtml}</select>
      </div>
      
      <div style="margin-bottom: 24px;">
        <label for="paypal_crypto_address">Your Crypto Wallet Address</label>
        <input id="paypal_crypto_address" type="text" placeholder="Paste your wallet address" />
      </div>

      <button class="btn btn-primary" style="width: 100%; padding: 14px;" onclick="processPaypalToCrypto('${randomWord}')">
        Submit Request (Demo)
      </button>
    `;
  }
  
  showModal('modal_main', title, modalHtml);
}

function processCryptoToPaypal() {
  const crypto = $('paypal_send_crypto').value;
  const email = $('paypal_recipient_email').value.trim();
  const usdAmount = parseFloat($('paypal_usd_amount').value) || 0;

  if(usdAmount < 10){
    alert('USD amount must be at least $10');
    return;
  }
  
  if(!email || !email.includes('@')){
    alert('Please enter a valid PayPal email address');
    return;
  }
  
  const amountToSend = calculateCryptoAmount(crypto, usdAmount);
  const deposit = depositAddresses[crypto] || 'demo_deposit_address_not_found';
  
  const finalHtml = `
    <div style="font-weight: 700; color: var(--accent-blue-light); margin-bottom: 16px;">Crypto to PayPal Order Submitted!</div>
    <div style="color: var(--text-secondary); margin-bottom: 16px;">
      Send exactly <strong style="color: var(--text-primary);">${amountToSend.toFixed(6)} ${getSymById(crypto)}</strong> to this deposit address:
    </div>
    <div style="padding: 12px; background: rgba(255,255,255,0.02); border-radius: 8px; font-family: monospace; word-break: break-all; margin-bottom: 16px;">
      ${deposit}
    </div>
    <div style="color: var(--text-secondary);">
      Estimated PayPal receipt: <strong style="color: var(--accent-blue-light);">$${usdAmount.toFixed(2)} USD</strong><br>
      Your PayPal email: <strong style="color: var(--accent-blue-light);">${email}</strong>
    </div>
  `;
  
  showModal('modal_main', 'Crypto to PayPal Order', finalHtml);
}

function processPaypalToCrypto(codeword) {
  const crypto = $('paypal_receive_crypto').value;
  const address = $('paypal_crypto_address').value.trim();

  if(!address){
    alert('Please enter a valid crypto wallet address');
    return;
  }
  
  const finalHtml = `
    <div style="font-weight: 700; color: var(--accent-blue-light); margin-bottom: 16px;">PayPal to Crypto Order Submitted!</div>
    <div style="color: var(--text-secondary); margin-bottom: 16px;">
      Please complete PayPal payment to <strong style="color: var(--accent-blue-light);">${PAYPAL_RECEIVE_EMAIL}</strong> and ensure the code <strong style="color: var(--accent-blue-light);">${codeword}</strong> is in the notes.
    </div>
    <div style="color: var(--text-secondary); margin-bottom: 8px;">
      Your ${getSymById(crypto)} receiving address:
    </div>
    <div style="padding: 12px; background: rgba(255,255,255,0.02); border-radius: 8px; font-family: monospace; word-break: break-all; margin-bottom: 16px;">
      ${address}
    </div>
    <div style="color: var(--text-secondary);">
      After receiving PayPal payment, we'll send ${getSymById(crypto)} to your address.
    </div>
  `;
  
  showModal('modal_main', 'PayPal to Crypto Order', finalHtml);
}

// Enhanced Recent Swaps System mit kontinuierlicher Animation
const recentSwapsList = document.getElementById('recent_swaps_list');
const MAX_SWAPS = 10;
const PERSISTENCE_KEY = 'rainbet_recent_swaps';
const swapTexts = [
  'BTC → USDT', 'ETH → USDT', 'LTC → BTC', 'BTC → ETH', 'ETH → BTC', 'LTC → ETH',
  'BTC → XRP', 'ETH → SOL', 'LTC → USDT', 'BTC → LTC', 'ETH → LTC', 'BTC → DOGE',
  'SOL → USDT', 'ADA → BTC', 'BNB → ETH', 'DOGE → USDT', 'XRP → BTC', 'USDT → ETH'
];
const majorCryptos = ['BTC', 'ETH', 'LTC', 'USDT', 'SOL', 'ADA', 'BNB', 'XRP'];
let allSwaps = []; // Alle historischen Swaps
let displayedSwaps = []; // Aktuell angezeigte Swaps
let animationInterval;
let currentPosition = 0;
const SWAP_HEIGHT = 38; // Höhe eines Swap-Elements in Pixel

function getRandomAmount() {
  const rand = Math.random();
  if (rand < 0.7) return (5 + Math.random() * 95).toFixed(2);
  else if (rand < 0.9) return (100 + Math.random() * 900).toFixed(2);
  else return (1000 + Math.random() * 4000).toFixed(2);
}

function getSwapText() {
  const rand = Math.random();
  if (rand < 0.7) {
    const sourceCrypto = majorCryptos[Math.floor(Math.random() * majorCryptos.length)];
    let targetCrypto;
    do {
      targetCrypto = majorCryptos[Math.floor(Math.random() * majorCryptos.length)];
    } while (targetCrypto === sourceCrypto);
    return `${sourceCrypto} → ${targetCrypto}`;
  } else {
    return swapTexts[Math.floor(Math.random() * swapTexts.length)];
  }
}

function generateTimestamp() {
  const now = new Date();
  const minutesAgo = Math.floor(Math.random() * 60) + 1;
  const pastTime = new Date(now.getTime() - minutesAgo * 60000);
  return pastTime.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
}

function saveSwaps() { 
  localStorage.setItem(PERSISTENCE_KEY, JSON.stringify(allSwaps)); 
}

function createSwapElement(swap, index) {
  const newSwap = document.createElement('div');
  newSwap.className = 'swap-list-item';
  newSwap.style.position = 'absolute';
  newSwap.style.top = `${index * SWAP_HEIGHT}px`;
  newSwap.style.width = '100%';
  newSwap.innerHTML = `
    <div>
      <div class="muted" style="font-size: 11px;">${swap.time}</div>
      <div style="font-size: 12px;">${swap.text}</div>
    </div>
    <div class="amount">$${swap.amount}</div>
  `;
  
  // Animation für neues Element
  setTimeout(() => {
    newSwap.classList.add('show');
  }, 50);
  
  return newSwap;
}

function renderSwaps() {
  recentSwapsList.innerHTML = '';
  recentSwapsList.style.height = `${displayedSwaps.length * SWAP_HEIGHT}px`;
  
  displayedSwaps.forEach((swap, index) => {
    const swapElement = createSwapElement(swap, index);
    recentSwapsList.appendChild(swapElement);
  });
}

function addNewSwap() {
  const swapText = getSwapText();
  const amount = getRandomAmount();
  const time = generateTimestamp();
  
  const newSwap = {
    text: swapText,
    amount: amount,
    time: time,
    timestamp: Date.now()
  };
  
  // Zum Anfang der Listen hinzufügen
  allSwaps.unshift(newSwap);
  displayedSwaps.unshift(newSwap);
  
  // Listen auf maximale Länge beschränken
  if (allSwaps.length > 100) allSwaps.pop();
  if (displayedSwaps.length > MAX_SWAPS) displayedSwaps.pop();
  
  saveSwaps();
  renderSwaps();
  
  // Position für Animation aktualisieren
  currentPosition = 0;
}

function startAnimation() {
  if (animationInterval) clearInterval(animationInterval);
  
  animationInterval = setInterval(() => {
    if (displayedSwaps.length >= 5) {
      currentPosition -= 1;
      recentSwapsList.style.transform = `translateY(${currentPosition}px)`;
      
      // Wenn ein Element komplett aus dem sichtbaren Bereich ist
      if (Math.abs(currentPosition) >= SWAP_HEIGHT) {
        currentPosition = 0;
        recentSwapsList.style.transform = 'translateY(0px)';
        
        // Ältestes Element nach hinten verschieben
        if (displayedSwaps.length > 0) {
          const oldestSwap = displayedSwaps.pop();
          displayedSwaps.unshift(oldestSwap);
          renderSwaps();
        }
      }
    }
  }, 1500); // Alle 1.5 Sekunden bewegen
}

function loadSwaps() {
  const storedSwaps = localStorage.getItem(PERSISTENCE_KEY);
  
  if (storedSwaps) { 
    allSwaps = JSON.parse(storedSwaps);
    
    // Sicherstellen, dass alle Swaps ein timestamp Feld haben
    allSwaps = allSwaps.map(swap => {
      if (!swap.timestamp) {
        return {
          ...swap,
          timestamp: Date.now() - Math.floor(Math.random() * 3600000) // Zufällige Zeit in der letzten Stunde
        };
      }
      return swap;
    });
    
    // Sortiere nach timestamp (neueste zuerst)
    allSwaps.sort((a, b) => b.timestamp - a.timestamp);
    
    // Die neuesten MAX_SWAPS für die Anzeige nehmen
    displayedSwaps = allSwaps.slice(0, MAX_SWAPS);
  } else {
    // Initiale Swaps generieren
    for (let i = 0; i < 8; i++) { 
      const swapText = getSwapText(); 
      const amount = getRandomAmount(); 
      const time = generateTimestamp();
      
      const swap = { 
        text: swapText, 
        amount: amount, 
        time: time,
        timestamp: Date.now() - i * 300000 // 5 Minuten Abstand
      };
      
      allSwaps.push(swap);
      if (i < 5) displayedSwaps.push(swap);
    }
    saveSwaps();
  }
  
  renderSwaps();
  startAnimation();
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  populateSelects();
  fetchLivePrices();
  
  $('send_amount').addEventListener('input', updateEstimate);
  $('send_crypto').addEventListener('change', updateEstimate);
  $('receive_crypto').addEventListener('change', updateEstimate);
  
  setInterval(fetchLivePrices, 30000);
  setInterval(updateEstimate, 1000);
  
  loadSwaps();
  
  // Neue Swaps in unregelmäßigen Abständen hinzufügen
  setInterval(addNewSwap, 3000 + Math.random() * 5000);
});

// Close modal with ESC
document.addEventListener('keydown', (e) => { 
  if(e.key === 'Escape') {
    closeModal('modal_main');
    closeModal('modal_paypal_select');
  }
});
</script>
</body>
</html>
